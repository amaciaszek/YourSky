async function getJulianDateNoon() {
    const lat = parseFloat(document.getElementById('latitude').value);
    const lon = parseFloat(document.getElementById('longitude').value);
    const dateString = document.getElementById('date').value;

    const apiUrl = `https://timezone.bertold.org/timezone?lat=${lat}&lon=${lon}`;

    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        if (data.Zones.length > 0) {
            const timezoneId = data.Zones[0].TimezoneId;
            return calculateJulianDates(dateString, timezoneId);
        } else {
            console.error('No timezone data available for the provided coordinates.');
            return null;
        }
    } catch (error) {
        console.error('Failed to fetch timezone data:', error);
        return null;
    }
}

async function calculateJulianDates(dateString, timezoneId) {
    const date = new Date(dateString);
    date.setUTCHours(12, 0, 0, 0); // Set to UTC noon

    const utcOffset = timezoneOffsets[timezoneId]; // Retrieve the base UTC offset
    const isDst = isDaylightSavingTime(date) && daylightSavings[timezoneId]; // Check if DST is applicable

    const totalOffset = isDst ? utcOffset + 1 : utcOffset;

    const julianDates = [];

    for (let i = 0; i < 24; i++) { // Loop for three hours starting from noon
        const adjustedDate = new Date(date.getTime()); // Create a copy of the original date
        adjustedDate.setUTCHours(adjustedDate.getUTCHours() + i - totalOffset); // Adjust to local time
        const julianDate = dateToJulianDate(adjustedDate);
        julianDates.push(julianDate);
    }

    return julianDates;
}

function dateToJulianDate(date) {
    const time = date.getTime();
    const julianDate = time / 86400000 + 2440587.5;
    return julianDate;
}

function isDaylightSavingTime(date) {
    var year = date.getFullYear();
    var dstStart = new Date(Date.UTC(year, 2, 14, 2)); // Second Sunday of March
    dstStart.setDate(14 - (dstStart.getUTCDay() + 1) % 7);
    var dstEnd = new Date(Date.UTC(year, 10, 7, 2)); // First Sunday of November
    dstEnd.setDate(7 - (dstEnd.getUTCDay() + 1) % 7);
    return date >= dstStart && date < dstEnd;
}

// Predefined timezone offsets and DST observance based on your data
const timezoneOffsets = {
    "Africa/Abidjan": 0,
    "Africa/Accra": 0,
    "Africa/Addis_Ababa": 3,
    "Africa/Algiers": 1,
    "Africa/Asmara": 3,
    "Africa/Bamako": 0,
    "Africa/Bangui": 1,
    "Africa/Blantyre": 2,
    "Africa/Brazzaville": 1,
    "Africa/Cairo": 2,
    "Africa/Casablanca": 1,
    "Africa/Conakry": 0,
    "Africa/Dakar": 0,
    "Africa/Dar_es_Salaam": 3,
    "Africa/Douala": 1,
    "Africa/El_Aaiun": 1,
    "Africa/Freetown": 0,
    "Africa/Gaborone": 2,
    "Africa/Harare": 2,
    "Africa/Johannesburg": 2,
    "Africa/Juba": 2,
    "Africa/Khartoum": 2,
    "Africa/Kinshasa": 1,
    "Africa/Lagos": 1,
    "Africa/Libreville": 1,
    "Africa/Luanda": 1,
    "Africa/Lubumbashi": 2,
    "Africa/Lusaka": 2,
    "Africa/Maputo": 2,
    "Africa/Maseru": 2,
    "Africa/Mogadishu": 3,
    "Africa/Monrovia": 0,
    "Africa/Nairobi": 3,
    "Africa/Ndjamena": 1,
    "Africa/Niamey": 1,
    "Africa/Nouakchott": 0,
    "Africa/Ouagadougou": 0,
    "Africa/Tripoli": 2,
    "Africa/Windhoek": 2,
    "America/Araguaina": -3,
    "America/Argentina/Buenos_Aires": -3,
    "America/Argentina/Catamarca": -3,
    "America/Argentina/Cordoba": -3,
    "America/Argentina/La_Rioja": -3,
    "America/Argentina/Mendoza": -3,
    "America/Argentina/Rio_Gallegos": -3,
    "America/Argentina/Salta": -3,
    "America/Argentina/San_Juan": -3,
    "America/Argentina/Ushuaia": -3,
    "America/Asuncion": -4,
    "America/Atikokan": -5,
    "America/Bahia": -3,
    "America/Belem": -3,
    "America/Belize": -6,
    "America/Blanc-Sablon": -4,
    "America/Boa_Vista": -4,
    "America/Bogota": -5,
    "America/Campo_Grande": -4,
    "America/Caracas": -4,
    "America/Creston": -7,
    "America/Cuiaba": -4,
    "America/Danmarkshavn": 0,
    "America/Dawson": -7,
    "America/Dawson_Creek": -7,
    "America/Fort_Nelson": -7,
    "America/Fortaleza": -3,
    "America/Guatemala": -6,
    "America/Guayaquil": -5,
    "America/Guyana": -4,
    "America/Jamaica": -5,
    "America/La_Paz": -4,
    "America/Lima": -5,
    "America/Managua": -6,
    "America/Manaus": -4,
    "America/Montevideo": -3,
    "America/Panama": -5,
    "America/Paramaribo": -3,
    "America/Phoenix": -7,
    "America/Porto_Velho": -4,
    "America/Puerto_Rico": -4,
    "America/Punta_Arenas": -3,
    "America/Regina": -6,
    "America/Rio_Branco": -5,
    "America/Santarem": -3,
    "America/Santiago": -4,
    "America/Sao_Paulo": -3,
    "America/Swift_Current": -6,
    "America/Tegucigalpa": -6,
    "America/Whitehorse": -7,
    "Antarctica/Casey": 11,
    "Antarctica/Davis": 7,
    "Antarctica/DumontDUrville": 10,
    "Antarctica/Mawson": 5,
    "Antarctica/McMurdo": 12,
    "Antarctica/Rothera": -3,
    "Antarctica/Syowa": 3,
    "Antarctica/Vostok": 6,
    "Asia/Aden": 3,
    "Asia/Almaty": 6,
    "Asia/Anadyr": 12,
    "Asia/Aqtau": 5,
    "Asia/Aqtobe": 5,
    "Asia/Ashgabat": 5,
    "Asia/Baghdad": 3,
    "Asia/Baku": 4,
    "Asia/Bangkok": 7,
    "Asia/Barnaul": 7,
    "Asia/Bishkek": 6,
    "Asia/Brunei": 8,
    "Asia/Chita": 9,
    "Asia/Choibalsan": 8,
    "Asia/Dili": 9,
    "Asia/Dubai": 4,
    "Asia/Dushanbe": 5,
    "Asia/Ho_Chi_Minh": 7,
    "Asia/Hovd": 7,
    "Asia/Irkutsk": 8,
    "Asia/Jakarta": 7,
    "Asia/Jayapura": 9,
    "Asia/Kabul": 4.5,
    "Asia/Kamchatka": 12,
    "Asia/Karachi": 5,
    "Asia/Kathmandu": 5.75,
    "Asia/Khandyga": 9,
    "Asia/Kolkata": 5.5,
    "Asia/Krasnoyarsk": 7,
    "Asia/Kuala_Lumpur": 8,
    "Asia/Magadan": 11,
    "Asia/Makassar": 8,
    "Asia/Manila": 8,
    "Asia/Muscat": 4,
    "Asia/Novokuznetsk": 7,
    "Asia/Omsk": 6,
    "Asia/Oral": 5,
    "Asia/Pontianak": 7,
    "Asia/Pyongyang": 9,
    "Asia/Qostanay": 6,
    "Asia/Qyzylorda": 5,
    "Asia/Riyadh": 3,
    "Asia/Samarkand": 5,
    "Asia/Seoul": 9,
    "Asia/Shanghai": 8,
    "Asia/Srednekolymsk": 11,
    "Asia/Taipei": 8,
    "Asia/Tashkent": 5,
    "Asia/Tbilisi": 4,
    "Asia/Tokyo": 9,
    "Asia/Tomsk": 7,
    "Asia/Ulaanbaatar": 8,
    "Asia/Ust-Nera": 10,
    "Asia/Vientiane": 7,
    "Asia/Vladivostok": 10,
    "Asia/Yakutsk": 9,
    "Asia/Yangon": 6.5,
    "Asia/Yekaterinburg": 5,
    "Atlantic/Reykjavik": 0,
    "Atlantic/South_Georgia": -2,
    "Australia/Adelaide": 9.5,
    "Australia/Brisbane": 10,
    "Australia/Darwin": 9.5,
    "Australia/Hobart": 10,
    "Australia/Melbourne": 10,
    "Australia/Perth": 8,
    "Australia/Sydney": 10,
    "Etc/GMT": 0,
    "Etc/GMT+1": -1,
    "Etc/GMT+10": -10,
    "Etc/GMT+11": -11,
    "Etc/GMT+12": -12,
    "Etc/GMT+2": -2,
    "Etc/GMT+3": -3,
    "Etc/GMT+4": -4,
    "Etc/GMT+5": -5,
    "Etc/GMT+6": -6,
    "Etc/GMT+7": -7,
    "Etc/GMT+8": -8,
    "Etc/GMT+9": -9,
    "Etc/GMT-1": 1,
    "Etc/GMT-10": 10,
    "Etc/GMT-11": 11,
    "Etc/GMT-12": 12,
    "Etc/GMT-2": 2,
    "Etc/GMT-3": 3,
    "Etc/GMT-4": 4,
    "Etc/GMT-5": 5,
    "Etc/GMT-6": 6,
    "Etc/GMT-7": 7,
    "Etc/GMT-8": 8,
    "Etc/GMT-9": 9,
    "Etc/UTC": 0,
    "Europe/Astrakhan": 4,
    "Europe/Dublin": 1,
    "Europe/Istanbul": 3,
    "Europe/Kirov": 3,
    "Europe/Minsk": 3,
    "Europe/Moscow": 3,
    "Europe/Samara": 4,
    "Europe/Saratov": 4,
    "Europe/Simferopol": 3,
    "Indian/Antananarivo": 3,
    "Pacific/Auckland": 12,
    "Pacific/Efate": 11,
    "Pacific/Fiji": 12,
    "Pacific/Galapagos": -6,
    "Pacific/Guadalcanal": 11,
    "Pacific/Honolulu": -10,
    "Pacific/Kiritimati": 14,
    "Pacific/Majuro": 12,
    "Pacific/Niue": -11,
    "Pacific/Noumea": 11,
    "Pacific/Port_Moresby": 10,
    "Pacific/Tahiti": -10,
    "America/Adak": -10,
    "America/Anchorage": -9,
    "America/Boise": -7,
    "America/Cambridge_Bay": -7,
    "America/Chicago": -6,
    "America/Denver": -7,
    "America/Detroit": -5,
    "America/Edmonton": -7,
    "America/Goose_Bay": -4,
    "America/Halifax": -4,
    "America/Havana": -5,
    "America/Inuvik": -7,
    "America/Iqaluit": -5,
    "America/Juneau": -9,
    "America/Los_Angeles": -8,
    "America/Matamoros": -6,
    "America/Mazatlan": -7,
    "America/Merida": -6,
    "America/Mexico_City": -6,
    "America/Moncton": -4,
    "America/Monterrey": -6,
    "America/Nassau": -5,
    "America/New_York": -5,
    "America/Nome": -9,
    "America/Nuuk": -3,
    "America/Port-au-Prince": -5,
    "America/Rankin_Inlet": -6,
    "America/St_Johns": -3.5,
    "America/Thule": -4,
    "America/Toronto": -5,
    "America/Vancouver": -8,
    "America/Winnipeg": -6,
    "Antarctica/Troll": 1,
    "Arctic/Longyearbyen": 1,
    "Asia/Damascus": 2,
    "Asia/Tehran": 3.5,
    "Atlantic/Canary": 0,
    "Europe/Amsterdam": 1,
    "Europe/Athens": 2,
    "Europe/Belgrade": 1,
    "Europe/Berlin": 1,
    "Europe/Bucharest": 2,
    "Europe/Budapest": 1,
    "Europe/Chisinau": 2,
    "Europe/Copenhagen": 1,
    "Europe/Helsinki": 2,
    "Europe/Ljubljana": 1,
    "Europe/London": 0,
    "Europe/Madrid": 1,
    "Europe/Oslo": 1,
    "Europe/Paris": 1,
    "Europe/Riga": 2,
    "Europe/Rome": 1,
    "Europe/Sarajevo": 1,
    "Europe/Sofia": 2,
    "Europe/Stockholm": 1,
    "Europe/Tallinn": 2,
    "Europe/Vilnius": 2,
    "Europe/Warsaw": 1
};

const daylightSavings = {
    "Africa/Abidjan": false,
    "Africa/Accra": false,
    "Africa/Addis_Ababa": false,
    "Africa/Algiers": false,
    "Africa/Asmara": false,
    "Africa/Bamako": false,
    "Africa/Bangui": false,
    "Africa/Blantyre": false,
    "Africa/Brazzaville": false,
    "Africa/Cairo": false,
    "Africa/Casablanca": false,
    "Africa/Conakry": false,
    "Africa/Dakar": false,
    "Africa/Dar_es_Salaam": false,
    "Africa/Douala": false,
    "Africa/El_Aaiun": false,
    "Africa/Freetown": false,
    "Africa/Gaborone": false,
    "Africa/Harare": false,
    "Africa/Johannesburg": false,
    "Africa/Juba": false,
    "Africa/Khartoum": false,
    "Africa/Kinshasa": false,
    "Africa/Lagos": false,
    "Africa/Libreville": false,
    "Africa/Luanda": false,
    "Africa/Lubumbashi": false,
    "Africa/Lusaka": false,
    "Africa/Maputo": false,
    "Africa/Maseru": false,
    "Africa/Mogadishu": false,
    "Africa/Monrovia": false,
    "Africa/Nairobi": false,
    "Africa/Ndjamena": false,
    "Africa/Niamey": false,
    "Africa/Nouakchott": false,
    "Africa/Ouagadougou": false,
    "Africa/Tripoli": false,
    "Africa/Windhoek": false,
    "America/Araguaina": false,
    "America/Argentina/Buenos_Aires": false,
    "America/Argentina/Catamarca": false,
    "America/Argentina/Cordoba": false,
    "America/Argentina/La_Rioja": false,
    "America/Argentina/Mendoza": false,
    "America/Argentina/Rio_Gallegos": false,
    "America/Argentina/Salta": false,
    "America/Argentina/San_Juan": false,
    "America/Argentina/Ushuaia": false,
    "America/Asuncion": false,
    "America/Atikokan": false,
    "America/Bahia": false,
    "America/Belem": false,
    "America/Belize": false,
    "America/Blanc-Sablon": false,
    "America/Boa_Vista": false,
    "America/Bogota": false,
    "America/Campo_Grande": false,
    "America/Caracas": false,
    "America/Creston": false,
    "America/Cuiaba": false,
    "America/Danmarkshavn": false,
    "America/Dawson": false,
    "America/Dawson_Creek": false,
    "America/Fort_Nelson": false,
    "America/Fortaleza": false,
    "America/Guatemala": false,
    "America/Guayaquil": false,
    "America/Guyana": false,
    "America/Jamaica": false,
    "America/La_Paz": false,
    "America/Lima": false,
    "America/Managua": false,
    "America/Manaus": false,
    "America/Montevideo": false,
    "America/Panama": false,
    "America/Paramaribo": false,
    "America/Phoenix": false,
    "America/Porto_Velho": false,
    "America/Puerto_Rico": false,
    "America/Punta_Arenas": false,
    "America/Regina": false,
    "America/Rio_Branco": false,
    "America/Santarem": false,
    "America/Santiago": false,
    "America/Sao_Paulo": false,
    "America/Swift_Current": false,
    "America/Tegucigalpa": false,
    "America/Whitehorse": false,
    "Antarctica/Casey": false,
    "Antarctica/Davis": false,
    "Antarctica/DumontDUrville": false,
    "Antarctica/Mawson": false,
    "Antarctica/McMurdo": false,
    "Antarctica/Rothera": false,
    "Antarctica/Syowa": false,
    "Antarctica/Vostok": false,
    "Asia/Aden": false,
    "Asia/Almaty": false,
    "Asia/Anadyr": false,
    "Asia/Aqtau": false,
    "Asia/Aqtobe": false,
    "Asia/Ashgabat": false,
    "Asia/Baghdad": false,
    "Asia/Baku": false,
    "Asia/Bangkok": false,
    "Asia/Barnaul": false,
    "Asia/Bishkek": false,
    "Asia/Brunei": false,
    "Asia/Chita": false,
    "Asia/Choibalsan": false,
    "Asia/Dili": false,
    "Asia/Dubai": false,
    "Asia/Dushanbe": false,
    "Asia/Ho_Chi_Minh": false,
    "Asia/Hovd": false,
    "Asia/Irkutsk": false,
    "Asia/Jakarta": false,
    "Asia/Jayapura": false,
    "Asia/Kabul": false,
    "Asia/Kamchatka": false,
    "Asia/Karachi": false,
    "Asia/Kathmandu": false,
    "Asia/Khandyga": false,
    "Asia/Kolkata": false,
    "Asia/Krasnoyarsk": false,
    "Asia/Kuala_Lumpur": false,
    "Asia/Magadan": false,
    "Asia/Makassar": false,
    "Asia/Manila": false,
    "Asia/Muscat": false,
    "Asia/Novokuznetsk": false,
    "Asia/Omsk": false,
    "Asia/Oral": false,
    "Asia/Pontianak": false,
    "Asia/Pyongyang": false,
    "Asia/Qostanay": false,
    "Asia/Qyzylorda": false,
    "Asia/Riyadh": false,
    "Asia/Samarkand": false,
    "Asia/Seoul": false,
    "Asia/Shanghai": false,
    "Asia/Srednekolymsk": false,
    "Asia/Taipei": false,
    "Asia/Tashkent": false,
    "Asia/Tbilisi": false,
    "Asia/Tokyo": false,
    "Asia/Tomsk": false,
    "Asia/Ulaanbaatar": false,
    "Asia/Ust-Nera": false,
    "Asia/Vientiane": false,
    "Asia/Vladivostok": false,
    "Asia/Yakutsk": false,
    "Asia/Yangon": false,
    "Asia/Yekaterinburg": false,
    "Atlantic/Reykjavik": false,
    "Atlantic/South_Georgia": false,
    "Australia/Adelaide": false,
    "Australia/Brisbane": false,
    "Australia/Darwin": false,
    "Australia/Hobart": false,
    "Australia/Melbourne": false,
    "Australia/Perth": false,
    "Australia/Sydney": false,
    "Etc/GMT": false,
    "Etc/GMT+1": false,
    "Etc/GMT+10": false,
    "Etc/GMT+11": false,
    "Etc/GMT+12": false,
    "Etc/GMT+2": false,
    "Etc/GMT+3": false,
    "Etc/GMT+4": false,
    "Etc/GMT+5": false,
    "Etc/GMT+6": false,
    "Etc/GMT+7": false,
    "Etc/GMT+8": false,
    "Etc/GMT+9": false,
    "Etc/GMT-1": false,
    "Etc/GMT-10": false,
    "Etc/GMT-11": false,
    "Etc/GMT-12": false,
    "Etc/GMT-2": false,
    "Etc/GMT-3": false,
    "Etc/GMT-4": false,
    "Etc/GMT-5": false,
    "Etc/GMT-6": false,
    "Etc/GMT-7": false,
    "Etc/GMT-8": false,
    "Etc/GMT-9": false,
    "Etc/UTC": false,
    "Europe/Astrakhan": false,
    "Europe/Dublin": false,
    "Europe/Istanbul": false,
    "Europe/Kirov": false,
    "Europe/Minsk": false,
    "Europe/Moscow": false,
    "Europe/Samara": false,
    "Europe/Saratov": false,
    "Europe/Simferopol": false,
    "Indian/Antananarivo": false,
    "Pacific/Auckland": false,
    "Pacific/Efate": false,
    "Pacific/Fiji": false,
    "Pacific/Galapagos": false,
    "Pacific/Guadalcanal": false,
    "Pacific/Honolulu": false,
    "Pacific/Kiritimati": false,
    "Pacific/Majuro": false,
    "Pacific/Niue": false,
    "Pacific/Noumea": false,
    "Pacific/Port_Moresby": false,
    "Pacific/Tahiti": false,
    "America/Adak": true,
    "America/Anchorage": true,
    "America/Boise": true,
    "America/Cambridge_Bay": true,
    "America/Chicago": true,
    "America/Denver": true,
    "America/Detroit": true,
    "America/Edmonton": true,
    "America/Goose_Bay": true,
    "America/Halifax": true,
    "America/Havana": true,
    "America/Inuvik": true,
    "America/Iqaluit": true,
    "America/Juneau": true,
    "America/Los_Angeles": true,
    "America/Matamoros": true,
    "America/Mazatlan": true,
    "America/Merida": true,
    "America/Mexico_City": true,
    "America/Moncton": true,
    "America/Monterrey": true,
    "America/Nassau": true,
    "America/New_York": true,
    "America/Nome": true,
    "America/Nuuk": true,
    "America/Port-au-Prince": true,
    "America/Rankin_Inlet": true,
    "America/St_Johns": true,
    "America/Thule": true,
    "America/Toronto": true,
    "America/Vancouver": true,
    "America/Winnipeg": true,
    "Antarctica/Troll": true,
    "Arctic/Longyearbyen": true,
    "Asia/Damascus": true,
    "Asia/Tehran": true,
    "Atlantic/Canary": true,
    "Europe/Amsterdam": true,
    "Europe/Athens": true,
    "Europe/Belgrade": true,
    "Europe/Berlin": true,
    "Europe/Bucharest": true,
    "Europe/Budapest": true,
    "Europe/Chisinau": true,
    "Europe/Copenhagen": true,
    "Europe/Helsinki": true,
    "Europe/Ljubljana": true,
    "Europe/London": true,
    "Europe/Madrid": true,
    "Europe/Oslo": true,
    "Europe/Paris": true,
    "Europe/Riga": true,
    "Europe/Rome": true,
    "Europe/Sarajevo": true,
    "Europe/Sofia": true,
    "Europe/Stockholm": true,
    "Europe/Tallinn": true,
    "Europe/Vilnius": true,
    "Europe/Warsaw": true
};

async function displayJulianDates() {
    const julianDates = await getJulianDateNoon();
    const output = document.getElementById('output');
    output.innerHTML = '<h3>Julian Dates at Noon and the Next Two Hours:</h3>';
    julianDates.forEach((date, index) => {
        output.innerHTML += `<p>Hour ${index + 1}: ${date}</p>`;
    });
}
